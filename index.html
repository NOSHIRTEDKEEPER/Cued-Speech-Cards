<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    body { display: flex; flex-direction: column; align-items: center; }
    #output { margin-top: 20px; font-size: 18px; }
  </style>
</head>
<body>
  <div id="output">Syllable: None</div>
<script>
let handshapes = [
  { label: "P Handshape", consonant: "p", x: 20, y: 20, origX: 20, origY: 20, color: "rgb(255, 200, 200)" },
  { label: "T Handshape", consonant: "t", x: 240, y: 20, origX: 240, origY: 20, color: "rgb(200, 255, 200)" }
];
let positions = [
  { 
    label: "Mouth", 
    x: 20, y: 200, 
    origX: 20, origY: 200, 
    color: "rgb(200, 200, 255)", 
    vowels: [
      { label: "æ", value: "æ", x: 20, y: 270 },
      { label: "ɑ", value: "ɑ", x: 80, y: 270 },
      { label: "ʌ", value: "ʌ", x: 140, y: 270 }
    ]
  },
  { 
    label: "Chin", 
    x: 240, y: 200, 
    origX: 240, origY: 200, 
    color: "rgb(255, 255, 200)", 
    vowels: [
      { label: "ɛ", value: "ɛ", x: 240, y: 270 },
      { label: "ɪ", value: "ɪ", x: 300, y: 270 }
    ]
  }
];
let slots = [
  { label: "Handshape Slot", x: 20, y: 100, width: 200, height: 60, content: null },
  { label: "Position Slot", x: 240, y: 100, width: 200, height: 60, content: null }
];
let draggedCard = null;
let selectedVowel = null;
let selectedVowelCard = null;
let selectedPosition = null;

function setup() {
  createCanvas(460, 350);
  textAlign(CENTER, CENTER);
  textSize(16);
}

function draw() {
  background(220);
  // Draw slots
  for (let slot of slots) {
    fill(255);
    stroke(0);
    strokeWeight(2);
    rect(slot.x, slot.y, slot.width, slot.height, 5);
    fill(0);
    noStroke();
    text(slot.label, slot.x + slot.width / 2, slot.y + slot.height / 2);
    if (slot.content) {
      fill(slot.content.color);
      stroke(0);
      strokeWeight(2);
      rect(slot.x, slot.y, slot.width, slot.height, 5);
      fill(0);
      noStroke();
      text(slot.content.label, slot.x + slot.width / 2, slot.y + slot.height / 2);
    }
  }
  // Draw handshapes
  for (let hs of handshapes) {
    if (draggedCard === hs) {
      fill("rgb(180, 180, 180)");
    } else {
      fill(hs.color);
    }
    stroke(0);
    strokeWeight(2);
    rect(hs.x, hs.y, 200, 60, 5);
    fill(0);
    noStroke();
    text(hs.label, hs.x + 100, hs.y + 30);
  }
  // Draw positions and vowel cards (skip if in slot)
  for (let pos of positions) {
    if (slots[1].content && slots[1].content.label === pos.label) continue;
    fill(selectedPosition === pos ? pos.color.replace(/(\d+), (\d+), (\d+)/, "$1, $2, 255") : pos.color);
    stroke(0);
    strokeWeight(2);
    rect(pos.x, pos.y, 200, 60, 5);
    fill(0);
    noStroke();
    text(pos.label, pos.x + 100, pos.y + 30);
    for (let vowel of pos.vowels) {
      fill(vowel === selectedVowelCard ? "rgb(100, 150, 255)" : 240);
      stroke(0);
      strokeWeight(2);
      rect(vowel.x, vowel.y, 50, 50, 5);
      fill(0);
      noStroke();
      text(vowel.label, vowel.x + 25, vowel.y + 25);
    }
  }
  // Draw vowel selection area for position in slot
  if (slots[1].content) {
    let pos = slots[1].content;
    for (let i = 0; i < pos.vowels.length; i++) {
      let vowel = pos.vowels[i];
      let vx = 20 + i * 70;
      let vy = 180;
      fill(vowel === selectedVowelCard ? "rgb(100, 150, 255)" : 240);
      stroke(0);
      strokeWeight(2);
      rect(vx, vy, 50, 50, 5);
      fill(0);
      noStroke();
      text(vowel.label, vx + 25, vy + 25);
    }
  } else {
    textAlign(CENTER);
    textSize(14);
    fill(150);
    text("No position selected", 110, 205);
  }
}

function mousePressed() {
  // Check for handshape or position selection
  for (let hs of handshapes) {
    if (mouseX > hs.x && mouseX < hs.x + 200 && mouseY > hs.y && mouseY < hs.y + 60) {
      draggedCard = hs;
      return;
    }
  }
  for (let pos of positions) {
    if (slots[1].content && slots[1].content.label === pos.label) continue;
    if (mouseX > pos.x && mouseX < pos.x + 200 && mouseY > pos.y && mouseY < pos.y + 60) {
      draggedCard = pos;
      return;
    }
    for (let vowel of pos.vowels) {
      if (mouseX > vowel.x && mouseX < vowel.x + 50 && mouseY > vowel.y && mouseY < vowel.y + 50) {
        selectedVowel = vowel.value;
        selectedVowelCard = vowel;
        selectedPosition = pos;
        if (!slots[1].content || slots[1].content.label !== pos.label) {
          document.getElementById("output").innerText = `Syllable: /${selectedVowel}/`;
        }
        return;
      }
    }
  }
  // Check for vowel selection in selection area
  if (slots[1].content) {
    let pos = slots[1].content;
    for (let i = 0; i < pos.vowels.length; i++) {
      let vx = 20 + i * 70;
      let vy = 180;
      if (mouseX > vx && mouseX < vx + 50 && mouseY > vy && mouseY < vy + 50) {
        selectedVowel = pos.vowels[i].value;
        selectedVowelCard = pos.vowels[i];
        selectedPosition = pos;
        if (slots[0].content) {
          let syllable = slots[0].content.consonant + selectedVowel;
          document.getElementById("output").innerText = `Syllable: /${syllable}/`;
        } else {
          document.getElementById("output").innerText = `Syllable: /${selectedVowel}/`;
        }
        return;
      }
    }
  }
}

function mouseDragged() {
  if (draggedCard) {
    draggedCard.x = mouseX - 100;
    draggedCard.y = mouseY - 30;
  }
}

function mouseReleased() {
  if (draggedCard) {
    for (let slot of slots) {
      if (mouseX > slot.x && mouseX < slot.x + slot.width && mouseY > slot.y && mouseY < slot.y + slot.height) {
        let prevContent = slot.content;
        if (slot.label === "Handshape Slot" && draggedCard.consonant) {
          slot.content = draggedCard;
          if (prevContent) {
            prevContent.x = prevContent.origX;
            prevContent.y = prevContent.origY;
          }
          if (slots[1].content && selectedVowel) {
            let syllable = draggedCard.consonant + selectedVowel;
            document.getElementById("output").innerText = `Syllable: /${syllable}/`;
          } else {
            document.getElementById("output").innerText = `Syllable: /${draggedCard.consonant}/`;
          }
        } else if (slot.label === "Position Slot" && !draggedCard.consonant) {
          slot.content = draggedCard;
          selectedVowel = null;
          selectedVowelCard = null;
          selectedPosition = null;
          if (prevContent) {
            prevContent.x = prevContent.origX;
            prevContent.y = prevContent.origY;
          }
          if (slots[0].content) {
            document.getElementById("output").innerText = `Syllable: /${slots[0].content.consonant}/`;
          } else {
            document.getElementById("output").innerText = `Syllable: None`;
          }
        }
        draggedCard = null;
        return;
      }
    }
    draggedCard.x = draggedCard.origX;
    draggedCard.y = draggedCard.origY;
    draggedCard = null;
  }
}
</script>
</body>
</html>
