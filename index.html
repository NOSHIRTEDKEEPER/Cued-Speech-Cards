<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cued Speech Phoneme Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .word-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        .word-header {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        .phoneme-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .phoneme-card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            min-width: 100px;
        }
        .phoneme-card p {
            margin: 5px 0;
            font-size: 1em;
        }
        .cue-sequence {
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
            color: #4CAF50;
        }
        .navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .error {
            color: red;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Cued Speech Phoneme Display</h1>
    <div class="word-container" id="wordContainer">
        <div class="word-header" id="wordHeader">Loading...</div>
        <div class="phoneme-container" id="phonemeContainer"></div>
        <div class="cue-sequence" id="cueSequence"></div>
    </div>
    <div class="navigation">
        <button id="prevButton" disabled>Previous</button>
        <button id="nextButton" disabled>Next</button>
    </div>
    <div class="error" id="errorMessage"></div>

    <script>
        // Phoneme to Cued Speech mapping
        const phonemeMap = {
            'Th': { ipa: '/ð/', cue: 'Handshape 8' },
            'd': { ipa: '/d/', cue: 'Handshape 1' },
            'w': { ipa: '/w/', cue: 'Handshape 7' },
            'm': { ipa: '/m/', cue: 'Handshape 4' },
            'k': { ipa: '/k/', cue: 'Handshape 5' },
            'ay': { ipa: '/eɪ/', cue: 'Chin-Throat (CT)' }
        };

        // Fallback data if fetch fails
        const fallbackWords = [
            {
                word: "they",
                phonemes: [
                    { ipa: "/ð/", cue: "Handshape 8" },
                    { ipa: "/eɪ/", cue: "Chin-Throat (CT)" }
                ],
                cueSequence: "8CT"
            },
            {
                word: "day",
                phonemes: [
                    { ipa: "/d/", cue: "Handshape 1" },
                    { ipa: "/eɪ/", cue: "Chin-Throat (CT)" }
                ],
                cueSequence: "1CT"
            },
            {
                word: "way",
                phonemes: [
                    { ipa: "/w/", cue: "Handshape 7" },
                    { ipa: "/eɪ/", cue: "Chin-Throat (CT)" }
                ],
                cueSequence: "7CT"
            },
            {
                word: "make",
                phonemes: [
                    { ipa: "/m/", cue: "Handshape 4" },
                    { ipa: "/eɪ/", cue: "Chin-Throat (CT)" },
                    { ipa: "/k/", cue: "Handshape 5" }
                ],
                cueSequence: "4CT5"
            },
            {
                word: "made",
                phonemes: [
                    { ipa: "/m/", cue: "Handshape 4" },
                    { ipa: "/eɪ/", cue: "Chin-Throat (CT)" },
                    { ipa: "/d/", cue: "Handshape 1" }
                ],
                cueSequence: "4CT1"
            }
        ];

        // Function to process phoneme breakdown into phonemes and cue sequence
        function processPhonemes(phonemeBreakdown) {
            const phonemes = phonemeBreakdown.split(' ').map(p => phonemeMap[p] || { ipa: p, cue: 'Unknown' });
            let cueSequence = '';
            let i = 0;
            while (i < phonemes.length) {
                if (i + 1 < phonemes.length && phonemes[i + 1].ipa === '/eɪ/') {
                    cueSequence += phonemes[i].cue.replace('Handshape ', '') + phonemes[i + 1].cue.replace('Chin-Throat (CT)', 'CT');
                    i += 2;
                } else {
                    cueSequence += phonemes[i].cue.includes('Handshape')
                        ? phonemes[i].cue.replace('Handshape ', '')
                        : phonemes[i].cue;
                    i++;
                }
            }
            return { phonemes, cueSequence };
        }

        let words = [];
        let currentIndex = 0;

        // Function to display a word
        function displayWord(index) {
            if (!words.length) {
                document.getElementById("errorMessage").textContent = "No words available to display.";
                return;
            }
            const wordData = words[index];
            document.getElementById("wordHeader").textContent = `Word: ${wordData.word}`;
            
            const phonemeContainer = document.getElementById("phonemeContainer");
            phonemeContainer.innerHTML = "";
            wordData.phonemes.forEach(phoneme => {
                const card = document.createElement("div");
                card.className = "phoneme-card";
                card.innerHTML = `<p>Phoneme: ${phoneme.ipa}</p><p>Cue: ${phoneme.cue}</p>`;
                phonemeContainer.appendChild(card);
            });

            document.getElementById("cueSequence").textContent = `Cue Sequence: ${wordData.cueSequence}`;

            // Update button states
            document.getElementById("prevButton").disabled = index === 0;
            document.getElementById("nextButton").disabled = index === words.length - 1;
        }

        // Fetch data from JSON file
        async function loadWords() {
            try {
                const response = await fetch('words.json', { cache: 'no-store' });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status} (${response.statusText})`);
                }
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Response is not JSON');
                }
                const data = await response.json();
                
                // Process each word
                words = data.map(item => {
                    const { phonemes, cueSequence } = processPhonemes(item.phoneme_breakdown);
                    return {
                        word: item.word,
                        phonemes: phonemes,
                        cueSequence: cueSequence
                    };
                });

                if (words.length > 0) {
                    displayWord(currentIndex);
                } else {
                    document.getElementById("errorMessage").textContent = "No words found in the database.";
                }
            } catch (error) {
                console.error('Fetch error:', error);
                document.getElementById("errorMessage").textContent = `Error loading data: ${error.message}. Using fallback data.`;
                words = fallbackWords; // Use fallback data
                if (words.length > 0) {
                    displayWord(currentIndex);
                }
            }
        }

        // Navigation event listeners
        document.getElementById("prevButton").addEventListener("click", () => {
            if (currentIndex > 0) {
                currentIndex--;
                displayWord(currentIndex);
            }
        });

        document.getElementById("nextButton").addEventListener("click", () => {
            if (currentIndex < words.length - 1) {
                currentIndex++;
                displayWord(currentIndex);
            }
        });

        // Load words on page load
        loadWords();
    </script>
</body>
</html>
