<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    body { display: flex; flex-direction: column; align-items: center; }
    #output { margin-top: 20px; font-size: 18px; }
  </style>
</head>
<body>
  <div id="output">Syllable: None</div>
<script>
let handshapes = [
  { label: "P_Handshape", consonant: "p", x: 20, y: 20, origX: 20, origY: 20, color: "rgb(255, 200, 200)", img: null },
  { label: "T_Handshape", consonant: "t", x: 240, y: 20, origX: 240, origY: 20, color: "rgb(200, 255, 200)", img: null }
];
let positions = [
  { 
    label: "Mouth", 
    x: 20, y: 200, 
    origX: 20, origY: 200, 
    color: "rgb(200, 200, 255)", 
    img: null,
    vowels: [
      { label: "æ", value: "æ", x: 20, y: 270 },
      { label: "ɑ", value: "ɑ", x: 80, y: 270 },
      { label: "ʌ", value: "ʌ", x: 140, y: 270 }
    ]
  },
  { 
    label: "Chin", 
    x: 240, y: 200, 
    origX: 240, origY: 200, 
    color: "rgb(255, 255, 200)", 
    img: null,
    vowels: [
      { label: "ɛ", value: "ɛ", x: 240, y: 270 },
      { label: "ɪ", value: "ɪ", x: 300, y: 270 }
    ]
  }
];
let slots = [
  { label: "Handshape Slot", x: 20, y: 100, width: 200, height: 60, content: null },
  { label: "Position Slot", x: 240, y: 100, width: 200, height: 60, content: null }
];
let draggedCard = null;
let selectedVowel = null;
let selectedVowelCard = null;
let selectedPosition = null;
let isDraggingFromSlot = false;

function preload() {
  for (let hs of handshapes) {
    hs.img = loadImage(`images/${hs.label}.png`);
  }
  for (let pos of positions) {
    pos.img = loadImage(`images/${pos.label}.png`);
  }
}

function setup() {
  createCanvas(460, 350);
  textAlign(CENTER, CENTER);
  textSize(16);
}

function draw() {
  background(220);
  for (let slot of slots) {
    fill(255);
    stroke(0);
    strokeWeight(2);
    rect(slot.x, slot.y, slot.width, slot.height, 5);
    fill(0);
    noStroke();
    text(slot.label, slot.x + slot.width / 2, slot.y + slot.height / 2);
    if (slot.content && !isDraggingFromSlot) {
      image(slot.content.img, slot.x, slot.y, slot.width, slot.height);
    }
  }
  for (let hs of handshapes) {
    if (draggedCard === hs) {
      image(hs.img, hs.x, hs.y, 200, 60);
    } else if (!slots[0].content || slots[0].content !== hs) {
      fill(hs.color);
      rect(hs.x, hs.y, 200, 60, 5);
      image(hs.img, hs.x, hs.y, 200, 60);
    }
  }
  for (let pos of positions) {
    if (slots[1].content && slots[1].content.label === pos.label) continue;
    fill(selectedPosition === pos ? pos.color.replace(/(\d+), (\d+), (\d+)/, "$1, $2, 255") : pos.color);
    stroke(0);
    strokeWeight(2);
    rect(pos.x, pos.y, 200, 60, 5);
    image(pos.img, pos.x, pos.y, 200, 60);
    for (let vowel of pos.vowels) {
      fill(vowel === selectedVowelCard ? "rgb(100, 150, 255)" : 240);
      stroke(0);
      strokeWeight(2);
      rect(vowel.x, vowel.y, 50, 50, 5);
      fill(0);
      noStroke();
      text(vowel.label, vowel.x + 25, vowel.y + 25);
    }
  }
  if (slots[1].content) {
    let pos = slots[1].content;
    for (let i = 0; i < pos.vowels.length; i++) {
      let vowel = pos.vowels[i];
      let vx = 20 + i * 70;
      let vy = 180;
      fill(vowel === selectedVowelCard ? "rgb(100, 150, 255)" : 240);
      stroke(0);
      strokeWeight(2);
      rect(vx, vy, 50, 50, 5);
      fill(0);
      noStroke();
      text(vowel.label, vx + 25, vy + 25);
    }
  } else {
    textAlign(CENTER);
    textSize(14);
    fill(150);
    text("No position selected", 110, 205);
  }
}

function mousePressed() {
  for (let slot of slots) {
    if (slot.content && mouseX > slot.x && mouseX < slot.x + slot.width && mouseY > slot.y && mouseY < slot.y + slot.height) {
      draggedCard = slot.content;
      isDraggingFromSlot = true;
      slot.content = null;
      return;
    }
  }
  for (let hs of handshapes) {
    if (mouseX > hs.x && mouseX < hs.x + 200 && mouseY > hs.y && mouseY < hs.y + 60) {
      draggedCard = hs;
      return;
    }
  }
  for (let pos of positions) {
    if (slots[1].content && slots[1].content.label === pos.label) continue;
    if (mouseX > pos.x && mouseX < pos.x + 200 && mouseY > pos.y && mouseY < pos.y + 60) {
      draggedCard = pos;
      return;
    }
    for (let vowel of pos.vowels) {
      if (mouseX > vowel.x && mouseX < vowel.x + 50 && mouseY > vowel.y && mouseY < vowel.y + 50) {
        selectedVowel = vowel.value;
        selectedVowelCard = vowel;
        selectedPosition = pos;
        if (!slots[1].content || slots[1].content.label !== pos.label) {
          document.getElementById("output").innerText = `Syllable: /${selectedVowel}/`;
        }
        return;
      }
    }
  }
  if (slots[1].content) {
    let pos = slots[1].content;
    for (let i = 0; i < pos.vowels.length; i++) {
      let vx = 20 + i * 70;
      let vy = 180;
      if (mouseX > vx && mouseX < vx + 50 && mouseY > vy && mouseY < vy + 50) {
        selectedVowel = pos.vowels[i].value;
        selectedVowelCard = pos.vowels[i];
        selectedPosition = pos;
        if (slots[0].content) {
          let syllable = slots[0].content.consonant + selectedVowel;
          document.getElementById("output").innerText = `Syllable: /${syllable}/`;
        } else {
          document.getElementById("output").innerText = `Syllable: /${selectedVowel}/`;
        }
        return;
      }
    }
  }
}

function mouseDragged() {
  if (draggedCard) {
    draggedCard.x = mouseX - 100;
    draggedCard.y = mouseY - 30;
  }
}

function mouseReleased() {
  if (draggedCard) {
    let droppedInSlot = false;
    for (let slot of slots) {
      if (mouseX > slot.x && mouseX < slot.x + slot.width && mouseY > slot.y && mouseY < slot.y + slot.height) {
        if (slot.label === "Handshape Slot" && draggedCard.consonant && !isDraggingFromSlot) {
          slot.content = draggedCard;
          if (slots[1].content && selectedVowel) {
            let syllable = draggedCard.consonant + selectedVowel;
            document.getElementById("output").innerText = `Syllable: /${syllable}/`;
          } else {
            document.getElementById("output").innerText = `Syllable: /${draggedCard.consonant}/`;
          }
          droppedInSlot = true;
        } else if (slot.label === "Position Slot" && !draggedCard.consonant && !isDraggingFromSlot) {
          slot.content = draggedCard;
          selectedVowel = null;
          selectedVowelCard = null;
          selectedPosition = null;
          if (slots[0].content) {
            document.getElementById("output").innerText = `Syllable: /${slots[0].content.consonant}/`;
          } else {
            document.getElementById("output").innerText = `Syllable: None`;
          }
          droppedInSlot = true;
        }
      }
    }
    if (!droppedInSlot) {
      draggedCard.x = draggedCard.origX;
      draggedCard.y = draggedCard.origY;
    }
    isDraggingFromSlot = false;
    draggedCard = null;
  }
}
</script>
</body>
</html>
